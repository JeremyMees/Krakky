<button
  type="button"
  pButton
  pRipple
  icon="pi pi-users"
  class="p-button-raised add-btn"
  label="Create a new workspace"
  (click)="onAddWorkspace()"
></button>
<div class="workspace" *ngFor="let workspace of workspaces">
  <div class="workspace-flex">
    <div class="team">
      <avatar
        [title]="workspace.workspace.charAt(0).toUpperCase()"
        [bg_color]="workspace.bg_color"
        [color]="workspace.color"
      ></avatar>
      <h3
        class="team-title"
        (click)="
          selected_workspace = workspace; onSetForm(); opw.toggle($event)
        "
      >
        {{
          workspace.workspace.charAt(0).toUpperCase() +
            workspace.workspace.slice(1)
        }}
        <i
          class="pi pi-pencil"
          style="font-size: 0.75rem"
          pTooltip="Edit workspace title and color"
          [showDelay]="500"
        ></i>
      </h3>
      <p-overlayPanel #opw>
        <ng-template pTemplate>
          <form
            (submit)="onSaveWorkspaceTitle(workspaceForm)"
            [formGroup]="workspaceForm"
          >
            <div>
              <p-colorPicker formControlName="color"></p-colorPicker>
              <span class="label">Color picker</span>
            </div>

            <input
              type="text"
              pInputText
              formControlName="title"
              placeholder="Workspace title"
              maxlength="20"
              autofocus
              autocomplete="off"
            />
            <div class="buttons">
              <button
                pButton
                pRipple
                icon="pi pi-save"
                label="Save"
                type="submit"
                class="p-button-raised"
                [disabled]="
                  $any(workspaceForm).controls['title'].value === undefined
                    ? true
                    : $any(workspaceForm).controls['title'].value?.length < 4
                    ? true
                    : $any(workspaceForm).controls['title'].value.length > 20
                    ? true
                    : false
                "
                (click)="opw.hide()"
              ></button>
              <button
                pButton
                pRipple
                label="Go back"
                type="button"
                class="p-button-raised p-button-text p-button-secondary"
                (click)="opw.hide()"
              ></button>
            </div>
          </form>
        </ng-template>
      </p-overlayPanel>
    </div>
    <div class="toolbar">
      <div
        class="card"
        (click)="router.navigateByUrl('team/' + workspace.workspace_id)"
      >
        <i class="pi pi-users icon"></i>
        Members ({{ workspace.team.length }})
      </div>
      <div
        class="card"
        (click)="router.navigateByUrl('workspace/' + workspace.workspace_id)"
      >
        <i class="pi pi-table icon"></i>
        Boards ({{ workspace.dashboards?.length }})
      </div>
      <div
        class="card"
        (click)="selected_workspace = workspace; menu.toggle($event)"
        pRipple
      >
        <mat-icon class="material-icons-outlined">settings</mat-icon>
        Settings
      </div>
      <p-menu #menu [popup]="true" [model]="items"></p-menu>
    </div>
    <div class="line light-grey-bg"></div>
  </div>
  <div class="dashboard-container">
    <div class="dashboards">
      <div
        class="dashboard light-grey-bg"
        *ngFor="
          let dashboard of onFilterDashboardMember(workspace.dashboards)
            | slice: 0:6
        "
        (click)="navigateToDashboard(dashboard.board_id)"
      >
        {{ dashboard.title.charAt(0).toUpperCase() + dashboard.title.slice(1) }}
      </div>
      <div
        class="create-dashboard light-grey-bg"
        *ngIf="workspace.dashboards.length === 0"
      >
        No joinable dashboards
      </div>
    </div>
  </div>
</div>

<p-toast></p-toast>
